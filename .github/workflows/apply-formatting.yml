name: Command Mode Formatting
on:
  issue_comment:
    types: [created]
jobs:
  apply-formatting:
    name: Format Python/C++ Code
    runs-on: ubuntu-latest
    if: startsWith(github.event.comment.body, '@par-hermes format')
    steps:
    - uses: AndrewGaspar/cpp-auto-formatter/command@v0.1
      with:
        botName: par-hermes
        clangFormatVersion: 8
        token: ${{ secrets.GITHUB_TOKEN }}                                                                                                                                
    - uses: actions/checkout@v2
        with:  # https://github.com/stefanzweifel/git-auto-commit-action#checkout-the-correct-branch
          ref: ${{ github.head_ref }}
          botName: par-hermes
          token: ${{ secrets.GITHUB_TOKEN }}   
      - uses: actions/setup-python@v2
      - run: pip install black
      - run: black --check .
      - name: If needed, commit black changes to the pull request
        if: failure()
        run: |
          printenv | grep GITHUB      
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/$GITHUB_REPOSITORY
          git remote -v
          git branch
          git status
          black .
          git status
          echo ready to commit
          git commit -am "fixup! Format Python code with psf/black pull_request"
          echo ready to push
          git push
          # git push --force origin

